<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>S1N Productive</title>
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        body: 'var(--bg-body)',
                        card: 'var(--bg-card)',
                        input: 'var(--bg-input)',
                        main: 'var(--text-main)',
                        muted: 'var(--text-muted)',
                        border: 'var(--border-light)',
                        borderDark: 'var(--border-dark)',
                    },
                    animation: { 
                        'fade-in': 'fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-in': 'slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pop': 'pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards',
                    }
                }
            }
        }
    </script>
    
    <script>
        if (localStorage.getItem('auraTheme') === 'dark' || 
           (!('auraTheme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-body text-main min-h-screen selection:bg-black selection:text-white dark:selection:bg-white dark:selection:text-black">

    <div id="auth-overlay" class="fixed inset-0 z-[200] flex flex-col items-center justify-center p-6 bg-body transition-all duration-500">
        <div class="w-full max-w-sm animate-fade-in">
            <div class="mb-12">
                <h1 class="text-5xl font-extrabold tracking-tighter leading-[0.9] mb-2">
                    S1N<br>PRODUCTIVE.
                </h1>
                <p class="text-muted font-medium text-lg mt-4">Focus. Execute. Repeat.</p>
            </div>
            <div class="auth-card p-8">
                <h2 id="auth-title" class="text-2xl font-bold mb-6 tracking-tight">Enter Workspace</h2>
                <form onsubmit="handleAuth(event)" class="space-y-4">
                    <div class="space-y-1.5">
                        <label class="text-[10px] font-bold text-muted uppercase tracking-widest">Username</label>
                        <input type="text" id="auth-name" required class="input-s1n" placeholder="name_01">
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-[10px] font-bold text-muted uppercase tracking-widest">Password</label>
                        <input type="password" id="auth-pass" required class="input-s1n" placeholder="••••••••">
                    </div>
                    <div id="field-confirm-pass" class="hidden space-y-1.5 animate-fade-in">
                        <label class="text-[10px] font-bold text-muted uppercase tracking-widest">Confirm</label>
                        <input type="password" id="auth-confirm-pass" class="input-s1n" placeholder="••••••••">
                    </div>
                    <button type="submit" id="auth-submit" class="btn-s1n w-full mt-4">Initialize Session</button>
                </form>
                <div class="mt-8 pt-6 border-t border-border">
                    <p id="toggle-auth-mode" class="text-sm text-center text-muted">
                        New agent? <span class="text-main font-bold cursor-pointer hover:underline" onclick="toggleAuthMode()">Create ID</span>
                    </p>
                </div>
            </div>
            <div class="mt-12 text-center">
                 <p class="text-[10px] font-bold text-muted uppercase tracking-[0.2em]">S1N Design System</p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden flex flex-col min-h-screen pb-24 max-w-lg mx-auto w-full relative"> 
        
        <header class="px-6 pt-12 pb-8 sticky top-0 z-40 bg-body/95 backdrop-blur-sm transition-all">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h1 class="text-4xl font-extrabold tracking-tighter leading-[0.9]">
                        S1N<br>PRODUCTIVE.
                    </h1>
                </div>
                <div class="flex gap-2">
                    <button onclick="window.openAccount()" class="w-10 h-10 rounded-full border border-border flex items-center justify-center hover:bg-card transition-colors">
                        <i data-lucide="user" class="w-5 h-5"></i>
                    </button>
                    <button onclick="openSettings()" class="w-10 h-10 rounded-full border border-border flex items-center justify-center hover:bg-card transition-colors">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            <div class="flex items-center gap-4 mt-4">
                <div class="flex items-center gap-2 px-3 py-1 border border-border rounded-full bg-card">
                    <i data-lucide="flame" class="w-3 h-3 text-main"></i>
                    <span id="streak-count" class="text-xs font-bold font-mono">0</span>
                </div>
                <div class="h-px flex-1 bg-border"></div> 
            </div>
        </header>

        <div class="px-6 flex-1 w-full relative">
            
            <section id="view-tasks" class="view-section animate-fade-in">
                <form id="task-form" class="mb-8">
                    <div class="relative group mb-3">
                        <input type="text" id="task-input" placeholder="New Protocol..." autocomplete="off" class="input-s1n text-lg font-medium py-4">
                    </div>
                    <div class="flex gap-2">
                        <input type="date" id="date-input" class="input-s1n w-auto text-xs">
                        <input type="time" id="time-input" class="input-s1n w-auto text-xs">
                        <button type="submit" id="add-btn" disabled class="btn-s1n ml-auto px-6 py-2">Add</button>
                    </div>
                </form>
                <div class="flex gap-2 mb-6 border-b border-border pb-4 overflow-x-auto scrollbar-hide">
                    <button data-filter="all" class="filter-btn active text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full border border-main bg-main text-body">All</button>
                    <button data-filter="active" class="filter-btn text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full border border-transparent text-muted hover:text-main">Active</button>
                    <button data-filter="completed" class="filter-btn text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full border border-transparent text-muted hover:text-main">Done</button>
                </div>
                <ul id="task-list" class="space-y-3"></ul>
                <div id="empty-state" class="hidden py-12 border border-dashed border-border rounded-2xl text-center">
                    <p class="text-muted font-medium">System Idle. Add Protocol.</p>
                </div>
            </section>

            <section id="view-focus" class="view-section hidden animate-fade-in flex flex-col items-center">
                <div id="active-task-display" class="hidden w-full mb-8">
                    <div class="flex items-center justify-between p-4 border border-border rounded-full bg-card">
                        <span class="text-xs font-bold uppercase tracking-wider text-muted ml-2">Focusing:</span>
                        <span id="focus-task-text" class="font-bold text-sm truncate px-2">Task Name</span>
                        <button onclick="clearFocusTask()" class="p-1 hover:text-rose-500"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                </div>
                <div class="card-s1n p-8 w-full flex flex-col items-center relative overflow-hidden mb-6">
                    <div class="relative w-64 h-64 mb-8">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="128" cy="128" r="118" stroke="var(--border-light)" stroke-width="2" fill="none" />
                            <circle id="progress-ring" cx="128" cy="128" r="118" stroke="var(--text-main)" stroke-width="4" fill="none" stroke-dasharray="741" stroke-dashoffset="0" stroke-linecap="round" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="timer-display" class="text-7xl font-extrabold tracking-tighter tabular-nums">25:00</span>
                            <span id="timer-status" class="text-xs font-bold uppercase tracking-[0.2em] mt-2 text-muted">Ready</span>
                        </div>
                    </div>
                    <div class="flex gap-4 w-full justify-center">
                        <button id="timer-reset" class="w-14 h-14 rounded-full border border-border flex items-center justify-center hover:bg-border transition-colors">
                            <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                        </button>
                        <button id="timer-toggle" class="h-14 px-8 rounded-full bg-main text-body font-bold text-lg flex items-center gap-2 hover:opacity-90 transition-opacity">
                            <i data-lucide="play" class="w-5 h-5 fill-current"></i> Start
                        </button>
                    </div>
                </div>
                <div class="flex justify-center gap-2 mb-8">
                    <button id="mode-work" class="px-4 py-2 text-xs font-bold uppercase tracking-wider rounded-full border border-main bg-main text-body">Focus</button>
                    <button id="mode-short" class="px-4 py-2 text-xs font-bold uppercase tracking-wider rounded-full border border-transparent text-muted hover:border-border">Short</button>
                    <button id="mode-long" class="px-4 py-2 text-xs font-bold uppercase tracking-wider rounded-full border border-transparent text-muted hover:border-border">Long</button>
                </div>
            </section>

            <section id="view-reports" class="view-section hidden animate-fade-in">
                <h2 class="text-3xl font-bold tracking-tight mb-6">Analytics.</h2>
                <div class="flex border-b border-border mb-6">
                    <button onclick="switchReportTab('daily')" data-type="daily" class="report-tab flex-1 pb-3 text-xs font-bold uppercase tracking-wider border-b-2 border-main text-main">Daily</button>
                    <button onclick="switchReportTab('weekly')" data-type="weekly" class="report-tab flex-1 pb-3 text-xs font-bold uppercase tracking-wider border-b-2 border-transparent text-muted hover:text-main">Weekly</button>
                    <button onclick="switchReportTab('monthly')" data-type="monthly" class="report-tab flex-1 pb-3 text-xs font-bold uppercase tracking-wider border-b-2 border-transparent text-muted hover:text-main">Monthly</button>
                </div>
                <div id="report-content" class="w-full space-y-4"></div>
            </section>

            <section id="view-contest" class="view-section hidden animate-fade-in">
                <h2 class="text-3xl font-bold tracking-tight mb-2">Network.</h2>
                <p class="text-muted text-sm mb-6">Global Leaderboard & Friends</p>
                <div class="flex gap-2 mb-6 overflow-x-auto scrollbar-hide">
                    <button id="tab-global" onclick="setSocialTab('global')" class="px-4 py-2 rounded-full border border-main bg-main text-body text-xs font-bold uppercase whitespace-nowrap">Global</button>
                    <button id="tab-league" onclick="setSocialTab('league')" class="px-4 py-2 rounded-full border border-border text-muted hover:text-main text-xs font-bold uppercase whitespace-nowrap">League</button>
                    <button id="tab-friends" onclick="setSocialTab('friends')" class="px-4 py-2 rounded-full border border-border text-muted hover:text-main text-xs font-bold uppercase whitespace-nowrap">Friends</button>
                </div>
                <div class="relative mb-6">
                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted"></i>
                    <input type="text" id="user-search" placeholder="Search Agent..." class="input-s1n pl-10">
                </div>
                <div id="contest-list" class="space-y-2 pb-24"></div>
            </section>

            <section id="view-shop" class="view-section hidden animate-fade-in">
                <div class="flex justify-between items-end mb-6">
                    <h2 class="text-3xl font-bold tracking-tight">Market.</h2>
                    <div class="text-right">
                        <span id="shop-points-display" class="block text-2xl font-bold font-mono">0</span>
                        <span class="text-[10px] font-bold uppercase text-muted tracking-wider">Credits</span>
                    </div>
                </div>
                <div id="shop-list" class="grid grid-cols-2 gap-4 pb-24"></div>
            </section>

            <section id="view-admin" class="view-section hidden animate-fade-in">
                <h2 class="text-3xl font-bold tracking-tight mb-6 text-rose-500">Admin Control.</h2>
                <input type="text" id="admin-search" placeholder="Search Database..." class="input-s1n mb-6">
                <div id="admin-user-list" class="space-y-3 pb-24"></div>
            </section>
        </div>

        <nav class="fixed bottom-6 left-6 right-6 max-w-[calc(100%-3rem)] md:max-w-md md:mx-auto bg-main text-body rounded-full px-6 py-4 shadow-2xl flex justify-between items-center z-50">
            <button onclick="switchView('tasks')" id="nav-tasks" class="nav-item opacity-100 transition-opacity">
                <i data-lucide="list" class="w-5 h-5"></i>
            </button>
            <button onclick="switchView('focus')" id="nav-focus" class="nav-item opacity-50 hover:opacity-100 transition-opacity">
                <i data-lucide="clock" class="w-5 h-5"></i>
            </button>
            <button onclick="switchView('reports')" id="nav-reports" class="nav-item opacity-50 hover:opacity-100 transition-opacity">
                <i data-lucide="bar-chart-2" class="w-5 h-5"></i>
            </button>
            <button onclick="switchView('contest')" id="nav-contest" class="nav-item opacity-50 hover:opacity-100 transition-opacity">
                <i data-lucide="globe" class="w-5 h-5"></i>
            </button>
            <button onclick="switchView('shop')" id="nav-shop" class="nav-item opacity-50 hover:opacity-100 transition-opacity">
                <i data-lucide="shopping-bag" class="w-5 h-5"></i>
            </button>
            <button onclick="switchView('admin')" id="nav-admin" class="nav-item hidden text-rose-300 opacity-100">
                <i data-lucide="shield" class="w-5 h-5"></i>
            </button>
        </nav>

    </div>

    <div id="account-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/50 backdrop-blur-sm">
        <div class="card-s1n w-full max-w-sm p-6 relative animate-pop">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold tracking-tight">Identity</h3>
                <button onclick="closeAccount()"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="p-3 border border-border rounded-xl text-center">
                    <div id="display-points" class="text-xl font-bold font-mono">0</div>
                    <div class="text-[10px] uppercase font-bold text-muted">Credits</div>
                </div>
                <div class="p-3 border border-border rounded-xl text-center">
                    <div id="display-streak" class="text-xl font-bold font-mono">0</div>
                    <div class="text-[10px] uppercase font-bold text-muted">Streak</div>
                </div>
            </div>

            <div id="profile-badges"></div>

            <div class="p-3 bg-input rounded-xl mb-4 text-center">
                 <p class="text-[10px] uppercase font-bold text-muted mb-1">Agent Name</p>
                 <p id="profile-name" class="font-bold text-lg">Guest</p>
            </div>

            <div class="space-y-2">
                <button onclick="toggleChangePass()" class="w-full py-2.5 border border-border rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-input transition-colors">Change Password</button>
                
                <div id="change-pass-form" class="hidden space-y-2 p-3 bg-input rounded-xl border border-border">
                    <input type="password" id="cp-old" placeholder="Old Pass" class="input-s1n py-2 text-sm bg-card">
                    <input type="password" id="cp-new" placeholder="New Pass" class="input-s1n py-2 text-sm bg-card">
                    <button onclick="submitChangePass()" id="cp-btn" class="btn-s1n w-full py-2 text-xs">Update</button>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <button onclick="logout()" class="py-2.5 border border-border rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-input transition-colors">Sign Out</button>
                    <button onclick="deleteAccount()" class="py-2.5 border border-rose-200 text-rose-500 rounded-xl text-xs font-bold uppercase tracking-wide hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-colors">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/50 backdrop-blur-sm">
        <div class="card-s1n w-full max-w-sm p-6 relative animate-pop">
            <h3 class="text-xl font-bold tracking-tight mb-6">System Config</h3>
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] font-bold text-muted uppercase tracking-wider block mb-3">Theme</label>
                    <div class="flex border border-border rounded-xl overflow-hidden">
                        <button onclick="setTheme('light')" id="theme-btn-light" class="flex-1 py-2 text-xs font-bold uppercase transition-colors">Light</button>
                        <button onclick="setTheme('dark')" id="theme-btn-dark" class="flex-1 py-2 text-xs font-bold uppercase transition-colors">Dark</button>
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-bold text-muted uppercase tracking-wider block mb-3">Timer (Minutes)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="text-center"><input type="number" id="setting-focus" class="input-s1n text-center p-2 text-sm"><span class="text-[10px] text-muted mt-1 block">Focus</span></div>
                        <div class="text-center"><input type="number" id="setting-short" class="input-s1n text-center p-2 text-sm"><span class="text-[10px] text-muted mt-1 block">Short</span></div>
                        <div class="text-center"><input type="number" id="setting-long" class="input-s1n text-center p-2 text-sm"><span class="text-[10px] text-muted mt-1 block">Long</span></div>
                    </div>
                </div>
                <button onclick="openNotificationHistory()" class="w-full flex justify-between items-center py-3 px-4 border border-border rounded-xl text-sm font-bold hover:bg-input">
                    <span>Notification Logs</span>
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </button>
            </div>
            <button onclick="saveSettings()" class="btn-s1n w-full mt-8">Save Config</button>
            <button onclick="closeSettings()" class="w-full mt-2 py-3 text-xs font-bold text-muted hover:text-main">Cancel</button>
        </div>
    </div>
    
    <div id="friend-modal" class="hidden fixed inset-0 z-[150] flex items-center justify-center p-6 bg-black/50 backdrop-blur-sm">
        <div id="friend-modal-content" class="card-s1n w-full max-w-sm p-6 relative animate-pop"></div>
    </div>

    <div id="notification-history-modal" class="hidden fixed inset-0 z-[150] flex items-center justify-center p-6 bg-black/50 backdrop-blur-sm">
        <div class="card-s1n w-full max-w-sm h-[60vh] flex flex-col p-6 animate-pop">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold">System Logs</h3>
                <button onclick="closeNotificationHistory()"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="notification-history-list" class="flex-1 overflow-y-auto space-y-2 pr-1 scrollbar-hide"></div>
            <button onclick="clearAllNotifications()" class="mt-4 text-xs font-bold text-rose-500 uppercase tracking-wider text-center">Clear Logs</button>
        </div>
    </div>

    <audio id="silence" loop><source src="data:audio/mp3;base64,SUQzBAAAAAAAI1RTSV*****" type="audio/mpeg"></audio>
    <audio id="alarm-sound" preload="auto"><source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg"></audio>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCq2wOw4L_bVUC4rINviWMBGjEtOALmgnE",
          authDomain: "auratask-fffd1.firebaseapp.com",
          databaseURL: "https://auratask-fffd1-default-rtdb.firebaseio.com",
          projectId: "auratask-fffd1",
          storageBucket: "auratask-fffd1.firebasestorage.app",
          messagingSenderId: "521351004914",
          appId: "1:521351004914:web:85825ddda114241372866b",
          measurementId: "G-4D1Q3FE9NK"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
    </script>
    
    <script src="auth.js"></script>
    <script src="social.js"></script>
    <script src="notifications.js"></script>
    <script src="profile.js"></script>
    <script src="shop.js"></script> 
    <script src="app.js"></script>
    <script src="pomodoro.js"></script>
    <script src="reports.js"></script>
    
    <script>
        lucide.createIcons();
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(el => {
                if(el.id !== 'nav-admin') el.classList.replace('opacity-100', 'opacity-50');
            });
            const target = document.getElementById('view-' + viewName);
            if(target) target.classList.remove('hidden');
            const nav = document.getElementById('nav-' + viewName);
            if(nav && viewName !== 'admin') nav.classList.replace('opacity-50', 'opacity-100');
            if(viewName === 'contest' && window.loadContestData) window.loadContestData();
            if(viewName === 'reports' && window.initReports) window.initReports();
            if(viewName === 'admin' && window.loadAdminPanel) window.loadAdminPanel();
            if(viewName === 'shop' && window.loadShop) window.loadShop(); 
        }
    </script>
</body>
</html>
